
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <title>前端问题回答</title>
	</head>
	<body>
    <div class="text-group">
      <div id="question">问题：</div>
      <div id="answer"  style="visibility: hidden;">答案：</div>
    </div>
    <div class="btn-group">
      <button id="btn" onclick="pre()">上一题</button>
      <button id="btn" onclick="next()">下一题</button>
      <button id="btn" onclick="playAudio()">重复</button>
      <button id="btn" onclick="mark()">标记</button>
      <button id="btn" onclick="clearMark()">清空标记</button>
      <button id="btn" onclick="toggleAnswer(!isShowAnswer)">显示答案</button>
    </div>
		<div id="audio">
			<audio id="tts_autio_id" autoplay="autoplay" src="">
			</audio>
    </div>
  </body>
  <style>
    body{
      font-size: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      height: 100vh;
    }
    #btn{
      margin-top: 10px;
      margin-right: 10px;
      width: 100px;
      height: 50px;
    }
    .btn-group{
      display: flex;
    }
    .text-group{
      width: 80vw;
    }
    #answer{
      margin-top: 10px;
    }
  

  </style>
  <script src="./question.js"></script>
  <script type="text/javascript"> 
    let index = -1;
    let speed = 8;
    let isShowAnswer = false
    let markList = []
    init()

    function init(){
      if(localStorage.getItem("index")){
        index = parseInt(localStorage.getItem("index")) 
        index--
        changeQuestion(true)
      }
      if(localStorage.getItem("MARK_LIST")){
        markList = JSON.parse(localStorage.getItem("MARK_LIST"))
        markRender(getText())
      }
    }


    function changeQuestion(isNext){
      isNext?index++:index--
      localStorage.setItem("index",index)
      changeShowText()
      changeAudioSrc(list[index][0])
      toggleAnswer(false)
      markRender(getText())
      playAudio()
    }

		function next(){
      if(list.length-1<=index){
        alert("已经到底")
        return
      }
      changeQuestion(true)
    }
    function pre(){
      if(index===0){
        alert("已经到头")
        return
      }
      changeQuestion(false)
    }

    function getText(){
      return list[index][0]
    }

    function changeShowText(){
       document.getElementById("question").innerHTML = `问题${index+1}:  ${getText()}`
    }

    function playAudio(){
      ttsAudio = document.getElementById('tts_autio_id');
			ttsAudio.play();
    }

    function changeAudioSrc(text){
      var ttsAudio = document.getElementById('tts_autio_id');
      var src = `http://tts.baidu.com/text2audio?lan=zh&ie=UTF-8&spd=${speed}&text=${text}`;
      document.getElementById('tts_autio_id').setAttribute("src",src)
    }

    function toggleAnswer(isShow){
      isShowAnswer  = isShow
      const ele = document.getElementById("answer")
      ele.innerText = `答案：${list[index][1]}`
      ele.style.visibility = isShowAnswer? "initial":"hidden"
    }

    function markRender(text){
      const ele = document.getElementById("question")
      const color = markList.includes(text)? "red" : "black"
      ele.style.color  = color
    }

    function clearMark(){
      if(confirm("确定要清空吗")){
        markList = []
        localStorage.removeItem("MARK_LIST")
        markRender("")
      } 
     
    }

    function mark(text){
      text = text || getText()
      const hasMark = markList.includes(text)
      if(hasMark){
        markList.splice(markList.indexOf(text),1) 
      }else{
        markList.push(text)
      }
      markRender(text)
      localStorage.setItem("MARK_LIST",JSON.stringify(markList))
    }
		</script>
</html>